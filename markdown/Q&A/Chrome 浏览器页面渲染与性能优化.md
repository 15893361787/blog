# Chrome 浏览器页面渲染与性能优化

### 背景
前段时间梳理了一下浏览器相关的知识，还做了一个公司级的分享，60多人过来听了我的分享，感觉还行，哈哈。先看一下分享目录：
<!-- 图 -->

本篇文章，如果直接贴ppt图，理解起来可能比较费劲，这里就大概讲一下内容，再附上我之前已经把部分内容输出了完整的文章的链接，方便大家结合ppt来理解，因此本文结合ppt食用效果更佳哦～

PS：公众号后台回复 浏览器 即可获取本次分享的完整ppt

### Chrome 基本架构介绍

#### 整体架构
浏览器的主要功能就是向服务器发出请求，在浏览器窗口中展示您选择的网络资源，这里所说的资源一般是指 HTML 文档，也可以是 PDF、图片或其他的类型。大体上，浏览器可以分为五部分：
<!-- 图 -->
+ 用户界面，主要负责展示页面中，除了 page 本身的内容，我们可以粗略地理解为打开一个空页面的时候呈现的界面就是浏览器的用户界面(GUI)。

+ 浏览器引擎，这里个人认为主要指的是在用户界面和渲染引擎之间传递指令，以及调度浏览器各方面的资源，协调为呈现页面、完成用户指令而工作。

+ 呈现引擎，按图中看，包含了一个 compositor(合成器)和 Javascript Engine(JS解释引擎)。分别是负责解析 HTML 和 CSS 内容，并将解析后的内容显示在屏幕上 和 用于解析和执行 JavaScript 代码。

+ 后端服务层，这里包含了一些后端服务。比如网络请求层(network)、数据存储，浏览器需要在硬盘上保存各种数据，例如 Cookie、Storage等。

+ 特别服务层，这里主要指的是一些浏览器自带的服务，比如你填完某个网站的账号密码，浏览器可以帮你记住账号密码，又比如开启浏览器的暗黑模式等特殊的服务。

以上，对前端来说，比较重要的是渲染引擎(一些文章也叫浏览器引擎)。我们可以看看都有哪些渲染引擎的内核。
<!-- 图 -->

#### 多进程架构
早期的web浏览器是单线程的，发生⻚⾯⾏为不当、浏览器错误、浏览器插件等错误都会引起整个浏览器或当前运 ⾏的选项卡关闭。因此Chrome将chromium应⽤程序放在相互隔离的独⽴的进程，也就是多进程的一个架构。
<!-- 图 -->

多进程的优势有：

+ 防⼀个⻚⾯崩溃影响整个浏览器
+ 安全性和沙盒，由于操作系统提供了限制进程权限的方法，因此浏览器可以从某些功能中，对某些进程进行沙箱处理。例如，Chrome 浏览器可以对处理用户输入（如渲染器）的进程，限制其文件访问的权限。
+ 进程有⾃⼰的私有内存空间，可以拥有更多的内存。

多进程的劣势有：
+ 给每个进程分配了单独的内存，尽管Chrome本身有一些优化策略，比如为了节省内存，Chrome限制了它可以启动的进程数量。限制因设备的内存和CPU功率⽽异，但当Chrome达到限制时，它会在⼀个进程中开始从同⼀站点运⾏多个选项卡。
+ 有更高的资源占用。因为每个进程都会包含公共基础结构的副本（如 JavaScript 运行环境），这就意味着浏览器会消耗更多的内存资源。

多进程的架构，还有优化的地方，因此 Chrome 未来的架构是一个面向服务的架构，将浏览器程序的每个部分，作为一项服务运行，从而可以轻松拆分为不同的流程或汇总为同一个流程。这样可以做到，当 Chrome 在强大的硬件上运行时，它可能会将每个服务拆分为不同的进程，从而提供更高的稳定性，但如果它位于资源约束的设备上，Chrome 会将服务整合到一个进程中，从而整合流程以减少内存使用。

关于架构这章，更详细的内容可以看我这篇文章，《XXX》

### 浏览器中页面渲染过程
渲染引擎的主要工作都是以HTML/JavaScript/CSS等文件作为输入，以可视化内容作为输出。不同的渲染引擎，主要在一些 CSS 的支持性上和渲染表现上不同。其渲染过程大致如下：
<!-- 图 -->
